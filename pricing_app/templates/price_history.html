{% extends "base.html" %}
{% block title %}Prices - {{ product.name }}{% endblock %}
{% block content %}
<h1>Price history – {{ product.name }}</h1>

<div class="card">
    <p><strong>Category:</strong> {{ product.category }} | <strong>Brand:</strong> {{ product.brand }}</p>

    <p><a href="{{ url_for('new_price', product_id=product.id) }}" class="btn btn-primary">Dodaj novu cenu</a></p>

    <table class="larg-table" style="text-align: center;">
        <tr>
            <th style="width: 70px;">Datum</th>
            <th>Cena ka nama</th>
            <th>Dodatni troskovi</th>
            <th>Uvoz %</th>
            <th>Zarada %</th>
            <th>Domaci transport</th>
            <th>Ukupno kostanje</th>
            <th>Izracunata cena</th>
            <th>Konacna cena</th>
            <th>Profit (Konačna cena)</th>
            <th>Popust %</th>
            <th>Cena sa popustom</th>
            <th>Profit (Cena sa popustom)</th>
            <th style="width: 60px;">Actions</th>
        </tr>
        {% for r in prices %}
        <tr>
            <td>
                <a href="{{ url_for('edit_price', product_id=product.id, price_id=r.id) }}">
                    {{ r.date | format_date }}
                </a>
            </td>
            <td>{{ r.base_price | round(2) }}</td>
            <td>{{ r.extras | round(2) }}</td>
            <td>{{ ((r.import_percent or 0) * 100) | round(2) }}</td>
            <td>{{ ((r.margin_percent or 0) * 100) | round(2) }}</td>
            <td>{{ (r.domestic_transport or 0) | round(2) }}</td>
            <td style="color: #e74c3c; font-weight: bold;">{{ (r.cost_total or 0) | round(2) }}</td>
            <td>{{ (r.calculated_price or 0) | round(2) }}</td>
            <td style="color: #2ecc71; font-weight: bold;">{{ (r.final_price or 0) | round(2) }}</td>
            <td style="color: #2ecc71;">{{ (r.profit_final or 0) | round(2) }}</td>
            <td>
                {% if r.discount_percent is not none %}
                {{ (r.discount_percent * 100) | round(2) }}
                {% endif %}
            </td>
            <td>
                {% if r.discount_price is not none %}
                <span style="color: #3498db; font-weight: bold;">{{ r.discount_price | round(2) }}</span>
                {% endif %}
            </td>
            <td style="color: #3498db;">
                {% if r.profit_discount is not none %}
                {{ r.profit_discount | round(2) }}
                {% endif %}
            </td>
            <td>
                <form method="post" action="{{ url_for('delete_price', product_id=product.id, price_id=r.id) }}"
                    style="display:inline;"
                    onsubmit="return confirm('Are you sure you want to delete this price entry?');">
                    <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                </form>
            </td>
        </tr>

        </tr>
        {% endfor %}
    </table>
</div>
{% endblock %}