{% extends "base.html" %}
{% block title %}Products{% endblock %}
{% block content %}
<h1>Proizvodi</h1>

<p><a href="{{ url_for('add_product') }}" class="btn btn-success">Dodaj proizvod</a></p>

<div class="card">
    <form method="get" action="{{ url_for('list_products') }}">
        <p>
            <label>Brand:
                <select name="brand" class="searchable-select" onchange="this.form.submit()">
                    <option value="">-- all brands --</option>
                    {% for b in brand_options %}
                    <option value="{{ b }}" {% if brand_filter==b %}selected{% endif %}>
                        {{ b }}
                    </option>
                    {% endfor %}
                </select>
            </label>
            &nbsp;&nbsp;
            <label>Category:
                <select name="category" class="searchable-select" onchange="this.form.submit()">
                    <option value="">-- all categories --</option>
                    {% for c in category_options %}
                    <option value="{{ c }}" {% if category_filter==c %}selected{% endif %}>
                        {{ c }}
                    </option>
                    {% endfor %}
                </select>
            </label>
            &nbsp;&nbsp;
            <label>Pretraga po imenu:
                <input type="text" name="search" value="{{ search_term or '' }}" onchange="this.form.submit()">
            </label>
            &nbsp;&nbsp;
            <a href="{{ url_for('list_products', clear=1) }}" class="btn"
                style="background-color: #6c757d; color: white;">Clear</a>
        </p>
    </form>
</div>

<div class="card">
    <table class="larg-table product-table">
        <tr>
            <th>Fotografija</th>
            <th>Naziv proizvoda</th>
            <th>Category</th>
            <th>Brand</th>
            <th>Trenutna cena</th>
            <th>Popust cena</th>
            <th>Actions</th>
        </tr>
        {% for p in products %}
        <tr>
            <td style="text-align: center; width: 85px;">
                {% if p.photo_path %}
                <img src="{{ url_for('product_image', filename=p.photo_path) }}"
                    style="max-width: 80px; max-height: 80px;">
                {% endif %}
            </td>
            <td>
                <a href="{{ url_for('edit_product', product_id=p.id) }}">
                    {{ p.name }}
                </a>
            </td>
            <td>{{ p.category }}</td>
            <td>{{ p.brand }}</td>
            <td>
                {% if p.current_price is not none %}
                <span style="color: #2ecc71; font-weight: bold;">{{ format_amount(p.current_price) }}</span>
                {% endif %}
            </td>
            <td>
                {% if p.current_discount_price is not none %}
                <span style="color: #3498db; font-weight: bold;">{{ format_amount(p.current_discount_price) }}</span>
                {% endif %}
            </td>
            <td style="text-align: center; width: 180px;">
                <a href="{{ url_for('price_history', product_id=p.id) }}" class="btn btn-primary btn-sm"
                    style="text-decoration: none;">History</a>

                <form method="post" action="{{ url_for('delete_product', product_id=p.id) }}" style="display:inline;"
                    onsubmit="return confirm('OBRISATI proizvod i SVE njegove cene?\nOvo se NE može poništiti.');">
                    <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                </form>
            </td>
            </td>
        </tr>
        {% endfor %}
    </table>
</div>
{% endblock %}