{% extends "base.html" %}

{% block title %}
{% if product %}Edit Product{% else %}Add Product{% endif %}
{% endblock %}

{% block content %}
<h1>
    {% if product %}Edit Product{% else %}Add Product{% endif %}
</h1>
{% if error %}
<p style="color:red; font-weight:bold;">
    {{ error }}
</p>
{% endif %}
<form method="post" enctype="multipart/form-data">
    <p>
        {% if brand_options %}
        <label>Brand:<br>
            <select name="brand">
                <option value="">-- choose brand --</option>
                {% for b in brand_options %}
                <option value="{{ b }}" {% if product and product.brand==b %}selected{% endif %}>
                    {{ b }}
                </option>
                {% endfor %}
            </select>
            <a href="{{ url_for('brands') }}">Dodaj novi brand</a>
        </label>
        {% else %}
        <label>Brand:<br>
            <input type="text" name="brand" value="{% if product %}{{ product.brand }}{% endif %}">
            <br>
            <small>No brands defined yet. Go to "Brands" first.</small>
        </label>
        {% endif %}
    </p>
    <p>
        {% if categories %}
        <label>Category:<br>
            <select name="category" required>
                <option value="">-- choose category --</option>
                {% for cat in categories %}
                <option value="{{ cat }}" {% if product and product.category==cat %}selected{% endif %}>
                    {{ cat }}
                </option>
                {% endfor %}
            </select>
            <a href="{{ url_for('category_defaults') }}">Dodaj novu ketgoriju</a>
        </label>
        {% else %}
        <label>Category:<br>
            <input type="text" name="category" value="{% if product %}{{ product.category }}{% endif %}">
            <br>
            <small>No categories defined yet. Go to "Category Defaults" first.</small>
        </label>
        {% endif %}
    </p>
    <p>
        <label>Name:<br>
            <input type="text" name="name" required class="long-input"
                value="{% if product %}{{ product.name }}{% endif %}">
        </label>
    </p>
    <p>
        <label>Description:<br>
            <textarea name="description" rows="8"
                cols="80">{% if product %}{{ product.description }}{% endif %}</textarea>
        </label>
    </p>
    <p>
        <label>Photo (JPG,PNG):<br>
            {% if product and product.photo_path %}
            Trenutna fotografija: {{ product.photo_path }}<br>
            <img src="{{ url_for('product_image', filename=product.photo_path) }}"
                style="max-width:120px; max-height:120px;"><br>
            {% endif %}
            <input type="file" name="photo_file" accept="image/jpeg, image/png">
            <br>
            <small>ILI unesite URL slike:</small><br>
            <input type="url" name="photo_url" placeholder="http://example.com/image.jpg" class="long-input">
        </label>
    </p>
    <p>
        <button type="submit" class="btn btn-success" name="action" value="save">
            {% if product %}Sacuvaj izmene{% else %}Save{% endif %}
        </button>
        {% if not product %}
        <button type="submit" class="btn btn-primary" name="action" value="save_add_price" style="margin-left: 10px;">
            Save & Add Price
        </button>
        {% else %}
        <a href="{{ url_for('price_history', product_id=product.id) }}" class="btn"
            style="margin-left: 10px; border:1px solid #ccc; text-decoration:none; padding: 2px 6px;">
            Prices
        </a>
        <a href="{{ url_for('new_price', product_id=product.id) }}" class="btn btn-primary"
            style="margin-left: 10px; text-decoration:none; color:white; background-color: #007bff; padding: 4px 8px; border-radius: 4px;">
            Add New Price
        </a>
        {% endif %}
    </p>
</form>
{% endblock %}