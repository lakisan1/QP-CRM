{# offer_body_inner.html #}

<table class="info-table" style="width: 100%; margin-bottom: 20px;">
    {% set items_list = items | list %}
    {% set ns = namespace(has_discount=false) %}
    {% for it in items_list %}
    {% if it.discount_percent and it.discount_percent > 0 %}
    {% set ns.has_discount = true %}
    {% endif %}
    {% endfor %}
    <tr>
        <td style="width: 50%; vertical-align: top;">
            <strong>{{ _('Customer') }}:</strong> {{ offer.client_name }}<br>
            {% if offer.client_pib %}<strong>PIB:</strong> {{ offer.client_pib }}<br>{% endif %}
            {% if offer.client_mb %}<strong>MB:</strong> {{ offer.client_mb }}<br>{% endif %}
        </td>
        <td style="width: 50%; vertical-align: top; text-align: right;">
            {% if offer.client_address %}<strong>{{ _('Address') }}:</strong> {{ offer.client_address }}<br>{% endif %}
            {% if offer.client_email %}
            <strong>E-mail:</strong>
            {% set emails = offer.client_email.replace(';', ',').replace(' ', ',').split(',') %}
            {% set ns_email = namespace(first=true) %}
            {% for email in emails %}
            {% if email.strip() %}
            {% if not ns_email.first %}<br>{% endif %}
            {{ email.strip() }}
            {% set ns_email.first = false %}
            {% endif %}
            {% endfor %}
            <br>
            {% endif %}
            {% if offer.client_phone %}<strong>{{ _('Tel') }}:</strong> {{ offer.client_phone }}<br>{% endif %}
        </td>
    </tr>
</table>

<div style="text-align: center; margin-bottom: 30px;">
    <h3 style="margin: 0; padding: 0;">{{ _('OFFER No.') }} {{ offer.offer_number or offer.id }}</h3>
    <div>{{ _('Date') }}: {{ offer.date | format_date(current_date_format) }}</div>
</div>

<h3 style="color: #0088cc; border-bottom: 2px solid #0088cc; padding-bottom: 5px; margin-top: 30px;">{{ _('Offer Items')
    }}</h3>
<table class="items-table">
    <thead>
        <tr>
            <th class="col-rb">{{ _('No.') }}</th>
            <th class="col-photo">{{ _('Image') }}</th>
            <th class="col-desc">{{ _('Description') }}</th>
            <th class="col-qty">{{ _('Qty') }}</th>
            <th class="col-unit">{{ _('Unit Price') }}</th>
            {% if ns.has_discount %}<th class="col-disc">Item disc.</th>{% endif %}
            <th class="col-total">{{ _('Total') }}</th>
        </tr>
    </thead>
    {% for it in items_list %}
    <tr>
        <td style="text-align:center;">{{ loop.index }}</td>

        <td style="text-align:center;">
            {% if it.item_photo_path %}
            {% if pdf_mode %}
            {% if it.item_photo_uri %}
            <img src="{{ it.item_photo_uri }}" style="max-width: 80px; max-height: 80px;">
            {% endif %}
            {% else %}
            <img src="{{ url_for('product_image', filename=it.item_photo_path) }}"
                style="max-width: 120px; max-height: 120px;">
            {% endif %}
            {% endif %}
        </td>

        <td>
            <strong>{{ it.item_name }}</strong><br>
            <small class="multiline">
                {{ it.item_description }}
            </small>
        </td>

        <td style="text-align:center;">
            {% if it.quantity % 1 == 0 %}{{ it.quantity | int }}{% else %}{{ it.quantity }}{% endif %}
        </td>

        <td style="text-align:right;">
            {{ format_amount(it.unit_price) }}
        </td>

        {% if ns.has_discount %}
        <td style="text-align:center;">
            {% if it.discount_percent %}
            {% set disc = (it.discount_percent * 100) | round(1) %}
            {% if disc % 1 == 0 %}{{ disc | int }}%{% else %}{{ disc }}%{% endif %}
            {% else %}0%{% endif %}
        </td>
        {% endif %}

        <td style="text-align:right;">
            {{ format_amount(it.line_net) }}
        </td>
    </tr>
    {% endfor %}
</table>

<div class="no-break-block">

    <br>
    <table class="totals-table">
        <tr>
            <td style="width:60%; text-align:left; color: var(--text-muted); font-size: 8.5pt;">
                Prices are in {{ offer.currency or 'EUR' }}.<br>
                {% if offer.currency != 'RSD' and offer.exchange_rate %}
                Calculated in RSD according to the exchange rate <strong>{{ offer.exchange_rate }}</strong> on the day
                of issuing the offer.
                {% endif %}<br>
                {{ _('PAYMENT TERMS') }}: {{ offer.payment_terms or 'as agreed' }}<br>
                {{ _('DELIVERY TERMS') }}: {{ offer.delivery_terms or 'as agreed' }}<br>
                {{ _('OFFER VALIDITY') }}: {{ offer.validity_days or 10 }} {{ _('days') }}<br>
                <br>
                {% if offer.napomena %}
                <strong>{{ _('NOTE') }}:</strong> {{ offer.napomena }}<br>
                {% endif %}
            </td>
            <td style="width:40%; text-align:right;">
                <table class="summary-box">
                    <tr>
                        <td style="text-align:right; color: var(--text-muted);">{{ _('SUBTOTAL') }}:</td>
                        <td style="text-align:right; width: 100px;">{{ format_amount(offer.total_net or 0) }}</td>
                    </tr>
                    <tr>
                        <td style="text-align:right; color: var(--text-muted);">{{ _('DISCOUNT') }} {{
                            ((offer.discount_percent or
                            0)
                            * 100) | round(2) }}%:</td>
                        <td style="text-align:right;">{{ format_amount(offer.total_discount or 0) }}</td>
                    </tr>
                    <tr class="total-row">
                        <td style="text-align:right;">{{ _('Total') }}:</td>
                        <td style="text-align:right;">{{ format_amount(offer.total_net_after_discount or 0) }}</td>
                    </tr>
                    <tr>
                        <td style="text-align:right; color: var(--text-muted);">{{ _('VAT') }} {{ ((offer.vat_percent or
                            0) * 100)
                            | round(2) }}%:</td>
                        <td style="text-align:right;">{{ format_amount(offer.total_vat or 0) }}</td>
                    </tr>
                    <tr class="final-total">
                        <td style="text-align:right; font-weight: bold;">{{ _('AMOUNT DUE') }}:
                        </td>
                        <td style="text-align:right; font-weight: bold;">{{
                            format_amount(offer.total_gross or 0) }}</td>
                    </tr>
                </table>
            </td>
        </tr>
    </table>

    {% if offer.notes %}
    <p style="font-size:12px; white-space:pre-line;">
        {{ offer.notes }}
    </p>
    {% endif %}

    <br><br>
    <table class="footer-table">
        <tr>
            <td style="text-align:left;">
                {{ _('Date') }}: {{ offer.date | format_date(current_date_format) }}
            </td>
            <td style="text-align:right;">
                {# Signature removed #}
            </td>
        </tr>
    </table>

    <p style="text-align:left;">
        <br>
        <strong>{{ _('THE OFFER IS VALID WITHOUT STAMP AND SIGNATURE') }}</strong>
    </p>

</div>