{% extends "base.html" %}
{% block title %}Quick Price Update{% endblock %}
{% block content %}
<h1>Brzo Ažuriranje Cena</h1>

<div class="card">
    <form method="get" action="{{ url_for('quick_update_products') }}">
        <p style="display: flex; flex-wrap: wrap; gap: 20px; align-items: flex-end;">
            <label style="display: flex; flex-direction: column;">
                <span style="margin-bottom: 8px; font-weight: 500; font-size: 14px;">Brand:</span>
                <select name="brand" class="searchable-select" onchange="this.form.submit()" style="margin-bottom: 0;">
                    <option value="">-- all brands --</option>
                    {% for b in brand_options %}
                    <option value="{{ b }}" {% if brand_filter==b %}selected{% endif %}>
                        {{ b }}
                    </option>
                    {% endfor %}
                </select>
            </label>
            <label style="display: flex; flex-direction: column;">
                <span style="margin-bottom: 8px; font-weight: 500; font-size: 14px;">Category:</span>
                <select name="category" class="searchable-select" onchange="this.form.submit()"
                    style="margin-bottom: 0;">
                    <option value="">-- all categories --</option>
                    {% for c in category_options %}
                    <option value="{{ c }}" {% if category_filter==c %}selected{% endif %}>
                        {{ c }}
                    </option>
                    {% endfor %}
                </select>
            </label>
            <label style="display: flex; flex-direction: column;">
                <span style="margin-bottom: 8px; font-weight: 500; font-size: 14px;">Pretraga po imenu:</span>
                <input type="text" name="search" value="{{ search_term or '' }}" onchange="this.form.submit()"
                    style="margin-bottom: 0;">
            </label>
        <div style="display: flex; flex-direction: column;">
            <span style="margin-bottom: 8px; font-weight: 500; font-size: 14px; visibility: hidden;">.</span>
            <a href="{{ url_for('quick_update_products', clear=1) }}" class="btn btn-secondary"
                style="margin-bottom: 0; padding: 12px 24px; font-size: 15px;">Clear</a>
        </div>
        </p>
    </form>
</div>

<div class="card">
    <table class="larg-table product-table">
        <tr>
            <th>Fotografija</th>
            <th>Naziv proizvoda</th>
            <th>Category</th>
            <th>Brand</th>
            <th>Trenutna cena</th>
            <th>Popust cena</th>
            <th style="width: 150px;">Nabavna cena</th>
            <th style="width: 150px;">Dodatni troškovi</th>
            <th>Actions</th>
        </tr>
        {% for p in products %}
        <tr>
            <td style="text-align: center; width: 85px;">
                {% if p.photo_path %}
                <img src="{{ url_for('product_image', filename=p.photo_path) }}"
                    style="max-width: 80px; max-height: 80px;">
                {% endif %}
            </td>
            <td>
                <a href="{{ url_for('price_history', product_id=p.id) }}" target="_blank">
                    {{ p.name }}
                </a>
            </td>
            <td>{{ p.category }}</td>
            <td>{{ p.brand }}</td>

            <td>
                {% if p.current_price %}
                <span style="color: #2ecc71; font-weight: bold;">{{ format_amount(p.current_price) }}</span>
                {% endif %}
            </td>
            <td>
                {% if p.current_discount_price %}
                <span style="color: #3498db; font-weight: bold;">{{ format_amount(p.current_discount_price) }}</span>
                {% endif %}
            </td>

            <!-- Update Form for this row -->
            <form method="POST" action="{{ url_for('quick_update_save', product_id=p.id) }}">
                <input type="hidden" name="ref_brand" value="{{ brand_filter or '' }}">
                <input type="hidden" name="ref_category" value="{{ category_filter or '' }}">
                <input type="hidden" name="ref_search" value="{{ search_term or '' }}">

                <td>
                    <input type="number" step="0.01" name="base_price" value="{{ p.latest_base_price or 0 }}"
                        style="width: 100%; box-sizing: border-box;">
                </td>
                <td>
                    <input type="number" step="0.01" name="extras" value="{{ p.latest_extras or 0 }}"
                        style="width: 100%; box-sizing: border-box;">
                </td>
                <td style="text-align: center;">
                    <button type="submit" class="btn btn-success btn-sm">Sačuvaj</button>
                </td>
            </form>
        </tr>
        {% endfor %}
    </table>
</div>
{% endblock %}