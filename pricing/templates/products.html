{% extends "base.html" %}
{% block title %}Products{% endblock %}
{% block content %}
<h1>{{ _('Products') }}</h1>

<p><a href="{{ url_for('add_product') }}" class="btn btn-success">{{ _('Add Product') }}</a></p>

<div class="card">
    <form method="get" action="{{ url_for('list_products') }}">
        <div style="display: flex; flex-wrap: wrap; gap: 20px; align-items: flex-end;">
            <label style="display: flex; flex-direction: row; align-items: center; gap: 10px;">
                <span style="font-weight: 500; font-size: 14px; white-space: nowrap;">Brand:</span>
                <div style="width: 200px;">
                    <select name="brand" class="searchable-select" onchange="this.form.submit()"
                        style="margin-bottom: 0;">
                        <option value="">-- all brands --</option>
                        {% for b in brand_options %}
                        <option value="{{ b }}" {% if brand_filter==b %}selected{% endif %}>
                            {{ b }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
            </label>
            <label style="display: flex; flex-direction: row; align-items: center; gap: 10px;">
                <span style="font-weight: 500; font-size: 14px; white-space: nowrap;">Category:</span>
                <div style="width: 200px;">
                    <select name="category" class="searchable-select" onchange="this.form.submit()"
                        style="margin-bottom: 0;">
                        <option value="">-- all categories --</option>
                        {% for c in category_options %}
                        <option value="{{ c }}" {% if category_filter==c %}selected{% endif %}>
                            {{ c }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
            </label>
            <label style="display: flex; flex-direction: row; align-items: center; gap: 10px;">
                <span style="font-weight: 500; font-size: 14px; white-space: nowrap;">Pretraga po imenu:</span>
                <input type="text" name="search" value="{{ search_term or '' }}" onchange="this.form.submit()"
                    style="margin-bottom: 0; width: 200px;">
            </label>
            <label style="display: flex; flex-direction: row; align-items: center; gap: 10px;">
                <span style="font-weight: 500; font-size: 14px; white-space: nowrap;">Sortiraj po:</span>
                <div style="width: 200px;">
                    <select name="sort" class="searchable-select" onchange="this.form.submit()"
                        style="margin-bottom: 0;">
                        <option value="name_asc" {% if sort_option=='name_asc' %}selected{% endif %}>Name (A-Z)</option>
                        <option value="name_desc" {% if sort_option=='name_desc' %}selected{% endif %}>Name (Z-A)
                        </option>
                        <option value="price_asc" {% if sort_option=='price_asc' %}selected{% endif %}>Price (Low to
                            High)</option>
                        <option value="price_desc" {% if sort_option=='price_desc' %}selected{% endif %}>Price (High to
                            Low)</option>
                    </select>
                </div>
            </label>
            <div style="display: flex; flex-direction: column;">
                <span style="margin-bottom: 8px; font-weight: 500; font-size: 14px; visibility: hidden;">.</span>
                <a href="{{ url_for('list_products', clear=1) }}" class="btn btn-secondary"
                    style="margin-bottom: 0; padding: 12px 24px; font-size: 15px;">Clear</a>
            </div>
        </div>
    </form>
</div>

<div class="card">
    <table class="larg-table product-table">
        <tr>
            <th>{{ _('Image') }}</th>
            <th>{{ _('Product') }}</th>
            <th>{{ _('Category') }}</th>
            <th>{{ _('Brand') }}</th>
            <th>{{ _('Current Price') }}</th>
            <th>{{ _('Discount Price') }}</th>
            <th>{{ _('Actions') }}</th>
        </tr>
        {% for p in products %}
        <tr>
            <td style="text-align: center; width: 85px;">
                {% if p.photo_path %}
                <img src="{{ url_for('product_image', filename=p.photo_path) }}"
                    style="max-width: 80px; max-height: 80px;">
                {% endif %}
            </td>
            <td>
                <a href="{{ url_for('price_history', product_id=p.id) }}">
                    {{ p.name }}
                </a>
            </td>
            <td>{{ p.category }}</td>
            <td>{{ p.brand }}</td>
            <td>
                {% if p.current_price is not none %}
                <span style="color: #2ecc71; font-weight: bold;">{{ format_amount(p.current_price) }}</span>
                {% endif %}
            </td>
            <td>
                {% if p.current_discount_price is not none %}
                <span style="color: #3498db; font-weight: bold;">{{ format_amount(p.current_discount_price) }}</span>
                {% endif %}
            </td>
            <td style="text-align: center; width: 250px;">
                <a href="{{ url_for('edit_product', product_id=p.id) }}" class="btn btn-primary btn-sm"
                    style="text-decoration: none; margin-right: 10px;">Izmeni proizvod</a>

                <form method="post" action="{{ url_for('delete_product', product_id=p.id) }}" style="display:inline;"
                    onsubmit="return confirm('OBRISATI proizvod i SVE njegove cene?\nOvo se NE može poništiti.');">
                    <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                </form>
            </td>
            </td>
        </tr>
        {% endfor %}
    </table>
</div>
{% endblock %}