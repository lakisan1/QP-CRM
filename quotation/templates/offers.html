{% extends "base.html" %}
{% block title %}Offers{% endblock %}

{% block content %}
<style>
    .tabs-container {
        display: flex;
        background: var(--card-bg);
        border-radius: 8px;
        padding: 5px;
        border: 1px solid var(--border-color);
    }

    .tab-item {
        padding: 8px 16px;
        text-decoration: none;
        border-radius: 6px;
        font-weight: 500;
        transition: all 0.2s;
    }

    .tab-item.active {
        color: white;
        background: var(--accent-primary);
    }

    .tab-item:not(.active) {
        color: var(--text-muted);
    }

    .tab-item:not(.active):hover {
        background: rgba(255, 255, 255, 0.05);
        color: var(--text-main);
    }
</style>
<h1>Pregled ponuda</h1>

<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
    <p style="margin: 0;"><a href="{{ url_for('new_offer') }}" class="btn btn-success">Kreiraj novu ponudu</a></p>

    <div class="tabs-container">
        <a href="{{ url_for('list_offers', view='offers') }}"
            class="tab-item {% if current_view == 'offers' %}active{% endif %}">
            Sve Ponude
        </a>
        <a href="{{ url_for('list_offers', view='templates') }}"
            class="tab-item {% if current_view == 'templates' %}active{% endif %}">
            Šabloni
        </a>
    </div>
</div>

<div class="card">
    <form method="get" action="{{ url_for('list_offers') }}">
        <p style="display: flex; flex-wrap: wrap; gap: 20px; align-items: flex-end;">
            <label style="display: flex; flex-direction: column;">
                <span style="margin-bottom: 8px; font-weight: 500; font-size: 14px;">Od datuma:</span>
                <input type="date" name="date_from" value="{{ date_from or '' }}" onchange="this.form.submit()"
                    style="margin-bottom: 0;">
            </label>
            <label style="display: flex; flex-direction: column;">
                <span style="margin-bottom: 8px; font-weight: 500; font-size: 14px;">Do datuma:</span>
                <input type="date" name="date_to" value="{{ date_to or '' }}" onchange="this.form.submit()"
                    style="margin-bottom: 0;">
            </label>
            <label style="display: flex; flex-direction: column;">
                <span style="margin-bottom: 8px; font-weight: 500; font-size: 14px;">Pretraga (ime musterije ili broj /
                    ime ponude):</span>
                <input type="text" name="search" value="{{ search_term or '' }}" onchange="this.form.submit()"
                    style="margin-bottom: 0;">
            </label>
            <label style="display: flex; flex-direction: column;">
                <span style="margin-bottom: 8px; font-weight: 500; font-size: 14px;">Država:</span>
                <select name="country" class="searchable-select" onchange="this.form.submit()"
                    style="margin-bottom: 0;">
                    <option value="">-- {% if current_language == 'en' %}all countries{% else %}sve države{% endif %} --
                    </option>
                    {% for c in countries %}
                    <option value="{{ c.name }}" {% if country_filter==c.name %}selected{% endif %}>
                        {% if current_language == 'en' %}{{ c.name_en }}{% else %}{{ c.name }}{% endif %} ({{ c.code }})
                    </option>
                    {% endfor %}
                </select>
            </label>
            <label style="display: flex; flex-direction: column;">
                <span style="margin-bottom: 8px; font-weight: 500; font-size: 14px;">Artikal:</span>
                <select name="item" class="searchable-select" onchange="this.form.submit()" style="margin-bottom: 0;">
                    <option value="">-- svi artikli --</option>
                    {% for p in products %}
                    <option value="{{ p.id }}" {% if item_filter and item_filter|int==p.id %}selected{% endif %}>
                        {{ p.name }}{% if p.brand %} ({{ p.brand }}){% endif %}
                        {% if p.category %} [{{ p.category }}]{% endif %}
                    </option>
                    {% endfor %}
                </select>
            </label>
        <div style="display: flex; flex-direction: column;">
            <span style="margin-bottom: 8px; font-weight: 500; font-size: 14px; visibility: hidden;">.</span>
            <a href="{{ url_for('list_offers', clear=1) }}" class="btn btn-secondary"
                style="margin-bottom: 0; padding: 12px 24px; font-size: 15px;">Reset
                pretrage</a>
        </div>
        </p>
    </form>
</div>

<div class="card">
    <table class="larg-table">
        <tr>
            <th>Datum</th>
            <th>Broj / ime ponude</th>
            <th>Država (Country)</th>
            <th>Naziv musterije</th>
            <th>Vrednost ponude</th>
            <th>Actions</th>
        </tr>
        {% for o in offers %}
        <tr>
            <td style="text-align: center; width: 80px;">{{ o.date | format_date }}</td>
            <td>
                <a href="{{ url_for('edit_offer', offer_id=o.id) }}">{{ o.offer_number or o.id }}</a>
            </td>
            <td>{{ o.country }}</td>
            <td>{{ o.client_name }}</td>
            <td style="width: 100px;">
                {% if o.total_gross is not none %}
                {{ format_amount(o.total_gross)}} {{ o.currency or '' }}
                {% endif %}
            </td>
            <td style="text-align: center; width: 220px;">
                <form method="post" action="{{ url_for('duplicate_offer', offer_id=o.id) }}" style="display:inline;"
                    onsubmit="return confirm('Duplirati ovu ponudu?');">
                    <button type="submit" class="btn btn-warning btn-sm">Duplicate</button>
                </form>

                <a href="{{ url_for('offer_pdf', offer_id=o.id) }}" target="_blank" class="btn btn-primary btn-sm">
                    PDF
                </a>

                <form method="post" action="{{ url_for('delete_offer', offer_id=o.id) }}" style="display:inline;"
                    onsubmit="return confirm('BRISANJE ponude!!! NIJE moguce vracanje nakon BRISANJA!!!.');">
                    <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </table>
</div>

{% endblock %}